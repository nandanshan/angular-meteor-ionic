(function(){var Meteor=Package.meteor.Meteor;var global=Package.meteor.global;var meteorEnv=Package.meteor.meteorEnv;var _=Package.underscore._;var Hook;(function(){Hook=function(options){var self=this;options=options||{};self.nextCallbackId=0;self.callbacks={};self.bindEnvironment=true;if(options.bindEnvironment===false)self.bindEnvironment=false;if(options.exceptionHandler)self.exceptionHandler=options.exceptionHandler;else if(options.debugPrintExceptions){if(!_.isString(options.debugPrintExceptions))throw new Error("Hook option debugPrintExceptions should be a string");self.exceptionHandler=options.debugPrintExceptions}};_.extend(Hook.prototype,{register:function(callback){var self=this;var exceptionHandler=self.exceptionHandler||function(exception){throw exception};if(self.bindEnvironment){callback=Meteor.bindEnvironment(callback,exceptionHandler)}else{callback=dontBindEnvironment(callback,exceptionHandler)}var id=self.nextCallbackId++;self.callbacks[id]=callback;return{stop:function(){delete self.callbacks[id]}}},each:function(iterator){var self=this;Meteor._nodeCodeMustBeInFiber();var ids=_.keys(self.callbacks);for(var i=0;i<ids.length;++i){var id=ids[i];if(_.has(self.callbacks,id)){var callback=self.callbacks[id];if(!iterator(callback))break}}}});var dontBindEnvironment=function(func,onException,_this){if(!onException||typeof onException==="string"){var description=onException||"callback of async function";onException=function(error){Meteor._debug("Exception in "+description+":",error&&error.stack||error)}}return function(){var args=_.toArray(arguments);var runAndHandleExceptions=function(){try{var ret=func.apply(_this,args)}catch(e){onException(e)}return ret};return runAndHandleExceptions()}}}).call(this);if(typeof Package==="undefined")Package={};(function(pkg,symbols){for(var s in symbols)s in pkg||(pkg[s]=symbols[s])})(Package["callback-hook"]={},{Hook:Hook})})();(function(){var Meteor=Package.meteor.Meteor;var global=Package.meteor.global;var meteorEnv=Package.meteor.meteorEnv;var Random=Package.random.Random;(function(){var key="_localstorage_test_"+Random.id();var retrieved;try{if(window.localStorage){window.localStorage.setItem(key,key);retrieved=window.localStorage.getItem(key);window.localStorage.removeItem(key)}}catch(e){}if(key===retrieved){Meteor._localStorage={getItem:function(key){return window.localStorage.getItem(key)},setItem:function(key,value){window.localStorage.setItem(key,value)},removeItem:function(key){window.localStorage.removeItem(key)}}}if(!Meteor._localStorage){Meteor._debug("You are running a browser with no localStorage or userData "+"support. Logging in from one tab will not cause another "+"tab to be logged in.");Meteor._localStorage={_data:{},setItem:function(key,val){this._data[key]=val},removeItem:function(key){delete this._data[key]},getItem:function(key){var value=this._data[key];if(value===undefined)return null;else return value}}}}).call(this);if(typeof Package==="undefined")Package={};Package.localstorage={}})();(function(){var Meteor=Package.meteor.Meteor;var global=Package.meteor.global;var meteorEnv=Package.meteor.meteorEnv;var _=Package.underscore._;var Tracker=Package.tracker.Tracker;var Deps=Package.tracker.Deps;var Random=Package.random.Random;var Hook=Package["callback-hook"].Hook;var DDP=Package["ddp-client"].DDP;var Mongo=Package.mongo.Mongo;var meteorInstall=Package.modules.meteorInstall;var Buffer=Package.modules.Buffer;var process=Package.modules.process;var Symbol=Package["ecmascript-runtime"].Symbol;var Map=Package["ecmascript-runtime"].Map;var Set=Package["ecmascript-runtime"].Set;var meteorBabelHelpers=Package["babel-runtime"].meteorBabelHelpers;var Promise=Package.promise.Promise;var Accounts,EXPIRE_TOKENS_INTERVAL_MS,CONNECTION_CLOSE_DELAY_MS;var require=meteorInstall({node_modules:{meteor:{"accounts-base":{"client_main.js":["./accounts_client.js","./url_client.js","./localstorage_token.js",function(require,exports,module){exports.__esModule=true;exports.AccountsTest=exports.AccountsClient=undefined;var _accounts_client=require("./accounts_client.js");var _url_client=require("./url_client.js");require("./localstorage_token.js");Accounts=new _accounts_client.AccountsClient;Meteor.users=Accounts.users;exports.AccountsClient=_accounts_client.AccountsClient;exports.AccountsTest=_url_client.AccountsTest}],"accounts_client.js":["babel-runtime/helpers/classCallCheck","babel-runtime/helpers/possibleConstructorReturn","babel-runtime/helpers/inherits","./accounts_common.js",function(require,exports){exports.__esModule=true;exports.AccountsClient=undefined;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _accounts_common=require("./accounts_common.js");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var AccountsClient=exports.AccountsClient=function(_AccountsCommon){(0,_inherits3["default"])(AccountsClient,_AccountsCommon);function AccountsClient(options){(0,_classCallCheck3["default"])(this,AccountsClient);var _this=(0,_possibleConstructorReturn3["default"])(this,_AccountsCommon.call(this,options));_this._loggingIn=false;_this._loggingInDeps=new Tracker.Dependency;_this._loginServicesHandle=_this.connection.subscribe("meteor.loginServiceConfiguration");_this._pageLoadLoginCallbacks=[];_this._pageLoadLoginAttemptInfo=null;_this._initUrlMatching();_this._initLocalStorage();return _this}AccountsClient.prototype.userId=function(){function userId(){return this.connection.userId()}return userId}();AccountsClient.prototype._setLoggingIn=function(){function _setLoggingIn(x){if(this._loggingIn!==x){this._loggingIn=x;this._loggingInDeps.changed()}}return _setLoggingIn}();AccountsClient.prototype.loggingIn=function(){function loggingIn(){this._loggingInDeps.depend();return this._loggingIn}return loggingIn}();AccountsClient.prototype.logout=function(){function logout(callback){var self=this;self.connection.apply("logout",[],{wait:true},function(error,result){if(error){callback&&callback(error)}else{self.makeClientLoggedOut();callback&&callback()}})}return logout}();AccountsClient.prototype.logoutOtherClients=function(){function logoutOtherClients(callback){var self=this;self.connection.apply("getNewToken",[],{wait:true},function(err,result){if(!err){self._storeLoginToken(self.userId(),result.token,result.tokenExpires)}});self.connection.apply("removeOtherTokens",[],{wait:true},function(err){callback&&callback(err)})}return logoutOtherClients}();return AccountsClient}(_accounts_common.AccountsCommon);var Ap=AccountsClient.prototype;Meteor.loggingIn=function(){return Accounts.loggingIn()};Ap.callLoginMethod=function(options){var self=this;options=_.extend({methodName:"login",methodArguments:[{}],_suppressLoggingIn:false},options);_.each(["validateResult","userCallback"],function(f){if(!options[f])options[f]=function(){}});var loginCallbacks=_.once(function(error){if(!error){self._onLoginHook.each(function(callback){callback();return true})}else{self._onLoginFailureHook.each(function(callback){callback();return true})}options.userCallback.apply(this,arguments)});var reconnected=false;var onResultReceived=function onResultReceived(err,result){if(err||!result||!result.token){}else{self.connection.onReconnect=function(){reconnected=true;var storedToken=self._storedLoginToken();if(storedToken){result={token:storedToken,tokenExpires:self._storedLoginTokenExpires()}}if(!result.tokenExpires)result.tokenExpires=self._tokenExpiration(new Date);if(self._tokenExpiresSoon(result.tokenExpires)){self.makeClientLoggedOut()}else{self.callLoginMethod({methodArguments:[{resume:result.token}],_suppressLoggingIn:true,userCallback:function(){function userCallback(error){var storedTokenNow=self._storedLoginToken();if(error){if(storedTokenNow&&storedTokenNow===result.token){self.makeClientLoggedOut()}}loginCallbacks(error)}return userCallback}()})}}}};var loggedInAndDataReadyCallback=function loggedInAndDataReadyCallback(error,result){if(reconnected)return;self._setLoggingIn(false);if(error||!result){error=error||new Error("No result from call to "+options.methodName);loginCallbacks(error);return}try{options.validateResult(result)}catch(e){loginCallbacks(e);return}self.makeClientLoggedIn(result.id,result.token,result.tokenExpires);loginCallbacks()};if(!options._suppressLoggingIn)self._setLoggingIn(true);self.connection.apply(options.methodName,options.methodArguments,{wait:true,onResultReceived:onResultReceived},loggedInAndDataReadyCallback)};Ap.makeClientLoggedOut=function(){if(this.connection._userId){this._onLogoutHook.each(function(callback){callback();return true})}this._unstoreLoginToken();this.connection.setUserId(null);this.connection.onReconnect=null};Ap.makeClientLoggedIn=function(userId,token,tokenExpires){this._storeLoginToken(userId,token,tokenExpires);this.connection.setUserId(userId)};Meteor.logout=function(callback){return Accounts.logout(callback)};Meteor.logoutOtherClients=function(callback){return Accounts.logoutOtherClients(callback)};Ap.loginServicesConfigured=function(){return this._loginServicesHandle.ready()};Ap.onPageLoadLogin=function(f){if(this._pageLoadLoginAttemptInfo){f(this._pageLoadLoginAttemptInfo)}else{this._pageLoadLoginCallbacks.push(f)}};Ap._pageLoadLogin=function(attemptInfo){if(this._pageLoadLoginAttemptInfo){Meteor._debug("Ignoring unexpected duplicate page load login attempt info");return}_.each(this._pageLoadLoginCallbacks,function(callback){callback(attemptInfo)});this._pageLoadLoginCallbacks=[];this._pageLoadLoginAttemptInfo=attemptInfo};if(Package.blaze){Package.blaze.Blaze.Template.registerHelper("currentUser",function(){return Meteor.user()});Package.blaze.Blaze.Template.registerHelper("loggingIn",function(){return Meteor.loggingIn()})}}],"accounts_common.js":["babel-runtime/helpers/classCallCheck",function(require,exports){exports.__esModule=true;exports.AccountsCommon=undefined;var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var AccountsCommon=exports.AccountsCommon=function(){function AccountsCommon(options){(0,_classCallCheck3["default"])(this,AccountsCommon);this._options={};this.connection=undefined;this._initConnection(options||{});this.users=new Mongo.Collection("users",{_preventAutopublish:true,connection:this.connection});this._onLoginHook=new Hook({bindEnvironment:false,debugPrintExceptions:"onLogin callback"});this._onLoginFailureHook=new Hook({bindEnvironment:false,debugPrintExceptions:"onLoginFailure callback"});this._onLogoutHook=new Hook({bindEnvironment:false,debugPrintExceptions:"onLogout callback"})}AccountsCommon.prototype.userId=function(){function userId(){throw new Error("userId method not implemented")}return userId}();AccountsCommon.prototype.user=function(){function user(){var userId=this.userId();return userId?this.users.findOne(userId):null}return user}();AccountsCommon.prototype.config=function(){function config(options){var self=this;if(Meteor.isServer){__meteor_runtime_config__.accountsConfigCalled=true}else if(!__meteor_runtime_config__.accountsConfigCalled){Meteor._debug("Accounts.config was called on the client but not on the "+"server; some configuration options may not take effect.")}if(_.has(options,"oauthSecretKey")){if(Meteor.isClient)throw new Error("The oauthSecretKey option may only be specified on the server");if(!Package["oauth-encryption"])throw new Error("The oauth-encryption package must be loaded to set oauthSecretKey");Package["oauth-encryption"].OAuthEncryption.loadKey(options.oauthSecretKey);options=_.omit(options,"oauthSecretKey")}var VALID_KEYS=["sendVerificationEmail","forbidClientAccountCreation","restrictCreationByEmailDomain","loginExpirationInDays"];_.each(_.keys(options),function(key){if(!_.contains(VALID_KEYS,key)){throw new Error("Accounts.config: Invalid key: "+key)}});_.each(VALID_KEYS,function(key){if(key in options){if(key in self._options){throw new Error("Can't set `"+key+"` more than once")}self._options[key]=options[key]}})}return config}();AccountsCommon.prototype.onLogin=function(){function onLogin(func){return this._onLoginHook.register(func)}return onLogin}();AccountsCommon.prototype.onLoginFailure=function(){function onLoginFailure(func){return this._onLoginFailureHook.register(func)}return onLoginFailure}();AccountsCommon.prototype.onLogout=function(){function onLogout(func){return this._onLogoutHook.register(func)}return onLogout}();AccountsCommon.prototype._initConnection=function(){function _initConnection(options){if(!Meteor.isClient){return}if(options.connection){this.connection=options.connection}else if(options.ddpUrl){this.connection=DDP.connect(options.ddpUrl)}else if(typeof __meteor_runtime_config__!=="undefined"&&__meteor_runtime_config__.ACCOUNTS_CONNECTION_URL){this.connection=DDP.connect(__meteor_runtime_config__.ACCOUNTS_CONNECTION_URL)}else{this.connection=Meteor.connection}}return _initConnection}();AccountsCommon.prototype._getTokenLifetimeMs=function(){function _getTokenLifetimeMs(){return(this._options.loginExpirationInDays||DEFAULT_LOGIN_EXPIRATION_DAYS)*24*60*60*1e3}return _getTokenLifetimeMs}();AccountsCommon.prototype._tokenExpiration=function(){function _tokenExpiration(when){return new Date(new Date(when).getTime()+this._getTokenLifetimeMs())}return _tokenExpiration}();AccountsCommon.prototype._tokenExpiresSoon=function(){function _tokenExpiresSoon(when){var minLifetimeMs=.1*this._getTokenLifetimeMs();var minLifetimeCapMs=MIN_TOKEN_LIFETIME_CAP_SECS*1e3;if(minLifetimeMs>minLifetimeCapMs)minLifetimeMs=minLifetimeCapMs;return new Date>new Date(when)-minLifetimeMs}return _tokenExpiresSoon}();return AccountsCommon}();var Ap=AccountsCommon.prototype;Meteor.userId=function(){return Accounts.userId()};Meteor.user=function(){return Accounts.user()};var DEFAULT_LOGIN_EXPIRATION_DAYS=90;var MIN_TOKEN_LIFETIME_CAP_SECS=3600;EXPIRE_TOKENS_INTERVAL_MS=600*1e3;CONNECTION_CLOSE_DELAY_MS=10*1e3;Meteor.startup(function(){var ServiceConfiguration=Package["service-configuration"].ServiceConfiguration;Ap.loginServiceConfiguration=ServiceConfiguration.configurations;Ap.ConfigError=ServiceConfiguration.ConfigError});var lceName="Accounts.LoginCancelledError";Ap.LoginCancelledError=Meteor.makeErrorType(lceName,function(description){this.message=description});Ap.LoginCancelledError.prototype.name=lceName;Ap.LoginCancelledError.numericError=145546287}],"localstorage_token.js":["./accounts_client.js",function(require){var _accounts_client=require("./accounts_client.js");var Ap=_accounts_client.AccountsClient.prototype;Meteor.loginWithToken=function(token,callback){return Accounts.loginWithToken(token,callback)};Ap.loginWithToken=function(token,callback){this.callLoginMethod({methodArguments:[{resume:token}],userCallback:callback})};Ap._enableAutoLogin=function(){this._autoLoginEnabled=true;this._pollStoredLoginToken()};Ap._isolateLoginTokenForTest=function(){this.LOGIN_TOKEN_KEY=this.LOGIN_TOKEN_KEY+Random.id();this.USER_ID_KEY=this.USER_ID_KEY+Random.id()};Ap._storeLoginToken=function(userId,token,tokenExpires){Meteor._localStorage.setItem(this.USER_ID_KEY,userId);Meteor._localStorage.setItem(this.LOGIN_TOKEN_KEY,token);if(!tokenExpires)tokenExpires=this._tokenExpiration(new Date);Meteor._localStorage.setItem(this.LOGIN_TOKEN_EXPIRES_KEY,tokenExpires);this._lastLoginTokenWhenPolled=token};Ap._unstoreLoginToken=function(){Meteor._localStorage.removeItem(this.USER_ID_KEY);Meteor._localStorage.removeItem(this.LOGIN_TOKEN_KEY);Meteor._localStorage.removeItem(this.LOGIN_TOKEN_EXPIRES_KEY);this._lastLoginTokenWhenPolled=null};Ap._storedLoginToken=function(){return Meteor._localStorage.getItem(this.LOGIN_TOKEN_KEY)};Ap._storedLoginTokenExpires=function(){return Meteor._localStorage.getItem(this.LOGIN_TOKEN_EXPIRES_KEY)};Ap._storedUserId=function(){return Meteor._localStorage.getItem(this.USER_ID_KEY)};Ap._unstoreLoginTokenIfExpiresSoon=function(){var tokenExpires=this._storedLoginTokenExpires();if(tokenExpires&&this._tokenExpiresSoon(new Date(tokenExpires))){this._unstoreLoginToken()}};Ap._initLocalStorage=function(){var self=this;self.LOGIN_TOKEN_KEY="Meteor.loginToken";self.LOGIN_TOKEN_EXPIRES_KEY="Meteor.loginTokenExpires";self.USER_ID_KEY="Meteor.userId";var rootUrlPathPrefix=__meteor_runtime_config__.ROOT_URL_PATH_PREFIX;if(rootUrlPathPrefix||this.connection!==Meteor.connection){var namespace=":"+this.connection._stream.rawUrl;if(rootUrlPathPrefix){namespace+=":"+rootUrlPathPrefix}self.LOGIN_TOKEN_KEY+=namespace;self.LOGIN_TOKEN_EXPIRES_KEY+=namespace;self.USER_ID_KEY+=namespace}if(self._autoLoginEnabled){self._unstoreLoginTokenIfExpiresSoon();var token=self._storedLoginToken();if(token){var userId=self._storedUserId();userId&&self.connection.setUserId(userId);self.loginWithToken(token,function(err){if(err){Meteor._debug("Error logging in with token: "+err);self.makeClientLoggedOut()}self._pageLoadLogin({type:"resume",allowed:!err,error:err,methodName:"login",methodArguments:[{resume:token}]})})}}self._lastLoginTokenWhenPolled=token;if(self._pollIntervalTimer){clearInterval(self._pollIntervalTimer)}self._pollIntervalTimer=setInterval(function(){self._pollStoredLoginToken()},3e3)};Ap._pollStoredLoginToken=function(){var self=this;if(!self._autoLoginEnabled){return}var currentLoginToken=self._storedLoginToken();if(self._lastLoginTokenWhenPolled!=currentLoginToken){if(currentLoginToken){self.loginWithToken(currentLoginToken,function(err){if(err){self.makeClientLoggedOut()}})}else{self.logout()}}self._lastLoginTokenWhenPolled=currentLoginToken}}],"url_client.js":["./accounts_client.js",function(require,exports){exports.__esModule=true;exports.AccountsTest=undefined;var _accounts_client=require("./accounts_client.js");var Ap=_accounts_client.AccountsClient.prototype;var accountsPaths=["reset-password","verify-email","enroll-account"];var savedHash=window.location.hash;Ap._initUrlMatching=function(){this._autoLoginEnabled=true;this._accountsCallbacks={};this._attemptToMatchHash()};Ap._attemptToMatchHash=function(){_attemptToMatchHash(this,savedHash,defaultSuccessHandler)};function _attemptToMatchHash(accounts,hash,success){_.each(accountsPaths,function(urlPart){var token;var tokenRegex=new RegExp("^\\#\\/"+urlPart+"\\/(.*)$");var match=hash.match(tokenRegex);if(match){token=match[1];if(urlPart==="reset-password"){accounts._resetPasswordToken=token}else if(urlPart==="verify-email"){accounts._verifyEmailToken=token}else if(urlPart==="enroll-account"){accounts._enrollAccountToken=token}}else{return}window.location.hash="";success.call(accounts,token,urlPart)})}function defaultSuccessHandler(token,urlPart){var self=this;self._autoLoginEnabled=false;Meteor.startup(function(){if(self._accountsCallbacks[urlPart]){self._accountsCallbacks[urlPart](token,function(){self._enableAutoLogin()})}})}var AccountsTest=exports.AccountsTest={attemptToMatchHash:function(){function attemptToMatchHash(hash,success){return _attemptToMatchHash(Accounts,hash,success)}return attemptToMatchHash}()};Ap.onResetPasswordLink=function(callback){if(this._accountsCallbacks["reset-password"]){Meteor._debug("Accounts.onResetPasswordLink was called more than once. "+"Only one callback added will be executed.")}this._accountsCallbacks["reset-password"]=callback};Ap.onEmailVerificationLink=function(callback){if(this._accountsCallbacks["verify-email"]){Meteor._debug("Accounts.onEmailVerificationLink was called more than once. "+"Only one callback added will be executed.")}this._accountsCallbacks["verify-email"]=callback};Ap.onEnrollmentLink=function(callback){if(this._accountsCallbacks["enroll-account"]){Meteor._debug("Accounts.onEnrollmentLink was called more than once. "+"Only one callback added will be executed.")}this._accountsCallbacks["enroll-account"]=callback}}]}}}},{extensions:[".js",".json"]});var exports=require("./node_modules/meteor/accounts-base/client_main.js");if(typeof Package==="undefined")Package={};(function(pkg,symbols){for(var s in symbols)s in pkg||(pkg[s]=symbols[s])})(Package["accounts-base"]=exports,{Accounts:Accounts})})();(function(){var Meteor=Package.meteor.Meteor;var global=Package.meteor.global;var meteorEnv=Package.meteor.meteorEnv;var Accounts=Package["accounts-base"].Accounts;var Mongo=Package.mongo.Mongo;var ServiceConfiguration;(function(){if(typeof ServiceConfiguration==="undefined"){ServiceConfiguration={}}ServiceConfiguration.configurations=new Mongo.Collection("meteor_accounts_loginServiceConfiguration",{_preventAutopublish:true,connection:Meteor.isClient?Accounts.connection:Meteor.connection});ServiceConfiguration.ConfigError=function(serviceName){if(Meteor.isClient&&!Accounts.loginServicesConfigured()){this.message="Login service configuration not yet loaded"}else if(serviceName){this.message="Service "+serviceName+" not configured"}else{this.message="Service not configured"}};ServiceConfiguration.ConfigError.prototype=new Error;ServiceConfiguration.ConfigError.prototype.name="ServiceConfiguration.ConfigError"}).call(this);if(typeof Package==="undefined")Package={};(function(pkg,symbols){for(var s in symbols)s in pkg||(pkg[s]=symbols[s])})(Package["service-configuration"]={},{ServiceConfiguration:ServiceConfiguration})})();Accounts=Package["accounts-base"].Accounts;